"""

    Name: bmx055.py
    Description: Module that contains classes for working with the BMX055 9-axis accelerometer chip.
    Author: Myron Walker


    =============================================================================================================================================================
    |  ADDR  |       7       |       6       |       5       |       4       |       3       |       2       |       1       |       0       | ACCESS | DEFAULT |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x3F  |                                                 fifo_data_output_register<7:0>                                                |   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x3E  |        fifo_mode<1:0>         |///////////////////////////////////////////////////////////////|      fifo_data_sel<1:0>       |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x3D  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   w/r  |  0xFF   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x3C  |                                                            GP1<7:0>                                                           |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x3B  |                                                            GP0<7:0>                                                           |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x3A  |                                                         offset_z<7:0>                                                         |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x39  |                                                         offset_y<7:0>                                                         |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x38  |                                                         offset_x<7:0>                                                         |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x37  |///////////////|     offset_target_z<1:0>      |     offset_target_y<1:0>      |     offset_target_x<1:0>      |    cut_off    |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x36  | offset_reset  |      cal_trigger<1:0>         |  cal_rdy      |///////////////|    hp_z_en    |    hp_y_en    |    hp_x_en    |   w/r  |  0x10   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x35  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x34  |///////////////////////////////////////////////////////////////////////////////|  i2c_wdt_en   |  i2c_wdt_sel  |     spi3      |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x33  |                         nvm_remain<3:0>                       |   nvm_load    |   nvm_rdy     | nvm_prog_trig | nvm_prog_mode |   w/r  |  0xF0   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x32  |///////////////////////////////////////////////| self_test_amp |///////////////|self_test_sign |     self_test_axis<1:0>       |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x31  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   w/r  |  0xFF   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x30  |///////////////////////////////|                    fifo_water_mark_level_trigger_retain<5:0>                                  |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x2F  |///////////////////////////////|     flat_hold_time<1:0>       |               |                  flat_hy<2:0>                 |   w/r  |  0x11   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x2E  |///////////////////////////////|                                flat_theta<5:0>                                                |   w/r  |  0x08   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x2D  |///////////////| orient_ud_en  |                               orient_theta<5:0>                                               |   w/r  |  0x48   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x2C  |///////////////|               orient_hyst<2:0>                |     orient_blocking<1:0>      |     orient_mode<1:0>          |   w/r  |  0x18   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x2B  |         tap_samp<1:0>         |///////////////|                                  tap_th<4:0>                                  |   w/r  |  0x0A   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x2A  |    tap_quiet  |  tap_shock    |///////////////////////////////////////////////|                  tap_dur<2:0>                 |   w/r  |  0x04   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x29  |                                                       slo_no_mot_th<7:0>                                                      |   w/r  |  0x14   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x28  |                                                         slope_th<7:0>                                                         |   w/r  |  0x14   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x27  |                                       slo_no_mot_dur<5:0>                                     |         slope_dur<1:0>        |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x26  |                                                          high_th<7:0>                                                         |   w/r  |  0xC0   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x25  |                                                          high_dur<7:0>                                                        |   w/r  |  0x0F   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x24  |           high_hy<1:0>        | //////////////////////////////////////////////|    low_mode   |            low_hy<1:0>        |   w/r  |  0x81   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x23  |                                                           low_th<7:0>                                                         |   w/r  |  0x30   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x22  |                                                           low_dur<7:0>                                                        |   w/r  |  0x09   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x21  |   reset_int   |///////////////////////////////////////////////|                         latch_int<3:0>                        |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x20  |///////////////////////////////////////////////////////////////|   int2_od     |   int2_lvl    |    int1_od    |    int1_lvl   |   w/r  |  0x05   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x1F  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   w/r  |  0xFF   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x1E  |                               |  int_src_data |  int_src_tap  |isrc_slo_no_mot| int_src_slope | int_src_high  |  int_src_low  |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x1D  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   w/r  |  0xFF   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x1C  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   w/r  |  0xFF   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x1B  |///////////////////////////////| int2_src_data | int2_src_tap  |i2sr_slo_no_mot| int2_src_slope| int2_src_high |  int2_src_low |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x1A  |   int2_data   |   int2_fwm    |   int2_ffull  |////////////////////////////////|   int1_ffull   |   int1_fwm    |   int1_data   |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x19  |   int1_flat   |  int1_orient  |   int1_s_tap  |  int1_d_tap   |int1_slo_no_mot|   int1_slope  |   int1_high   |   int1_low    |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x18  |///////////////////////////////////////////////////////////////| slo_no_mot_sel| slo_no_mo_en_z| slo_no_mo_en_y| slo_no_mo_en_x|   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x17  |///////////////|   int_fwm_en  |  int_ffull_en |    data_en    |     low_en    |   high_en_z   |   high_en_y   |    high_en_x  |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x16  |    flat_en    |   orient_en   |    s_tap_en   |    d_tap_en   |///////////////|   slope_en_z  |   slope_en_y  |   slope_en_x  |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x15  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   w/r  |  0xFF   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x14  |                                                          softreset                                                            |   wo   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x13  | data_high_bw  |   shadow_dis  |///////////////////////////////////////////////////////////////////////////////////////////////|   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x12  |///////////////| lowpower_mode |sleeptimer_mode|///////////////////////////////////////////////////////////////////////////////|   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x11  |    suspend    |  lowpower_en  |  deep_suspend |                          sleep_dur<3:0>                       |///////////////|   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x10  |///////////////////////////////////////////////|                                    bw<4:0>                                    |   w/r  |  0x0F   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x0F  |///////////////////////////////////////////////////////////////|                           range<3:0>                          |   w/r  |  0x03   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x0E  | fifo_overrun  |                                             fifo_frame_counter<6:0>                                           |   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x0D  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   w/r  |  0xFF   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x0C  |      flat     |                   orient<2:0>                 |   high_sign   | high_first_z  | high_first_y  | high_first_x  |   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x0B  |    tap_sign   |  tap_first_z  |  tap_first_y  |  tap_first_x  |  slope_sign   | slope_first_z | slope_first_y | slope_first_x |   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x0A  |    data_int   |  fifo_wm_int  | fifo_full_int |///////////////////////////////////////////////////////////////////////////////|   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x09  |    flat_int   |  orient_int   |   s_tap_int   |   d_tap_int   | slo_no_mot_int|    slope_int  |   high_int    |    low_int    |   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x08  |                                                            temp<7:0>                                                          |   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x07  |                                                         acc_z_lsb<11:4>                                                       |   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x06  |                         acc_z_lsb<3:0>                        |///////////////////////////////////////////////|  new_data_z   |   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x05  |                                                         acc_y_lsb<11:4>                                                       |   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x04  |                         acc_y_lsb<3:0>                        |///////////////////////////////////////////////|  new_data_y   |   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x03  |                                                         acc_x_lsb<11:4>                                                       |   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x02  |                         acc_x_lsb<3:0>                        |///////////////////////////////////////////////|  new_data_x   |   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x01  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   ro   |   --    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x00  |                                                         chip_id<7:0>                                                          |   ro   |  0xFA   |
    -------------------------------------------------------------------------------------------------------------------------------------------------------------
    
    
    
    =============================================================================================================================================================
    |  ADDR  |       7       |       6       |       5       |       4       |       3       |       2       |       1       |       0       | ACCESS | DEFAULT |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x3F  |                                                         fifo_data<7:0>                                                        |   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x3E  |        mode_select<1:0>       |                                                               |       data_select<1:0>        |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x3D  |      tag      |                                          h2o_mrk_lvl_trig_rel<6:0>                                            |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x3C  |///////////////////////////////////////////////|    rate_ok    |///////////////|   bist_fail   |    bist_rdy   |   trig_bist   |   ro   |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x3B  |                                                             gp0<11:4>                                                         |   w/r  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x3A  |                            gp0<3:0>                           |         offset_x<1:0>         |  offset_y<0>  |  offset_z<0>  |   w/r  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x39  |                                                         offset_z<11:4>                                                        |   w/r  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x38  |                                                         offset_y<11:4>                                                        |   w/r  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x37  |                                                         offset_x<11:4>                                                        |   w/r  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x36  |         offset_x<3:2>         |                 offset_y<3:1>                 |                  offset_z<3:1>                |   w/r  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x35  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x34  |///////////////////////////////| ext_fifo_sc_en| ext_fifo_s_sel| burst_same_en |  i2c_wdt_en   |  i2c_wdt_sel  |      spi3     |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x33  |                         nvm_remain<3:0>                       |    nvm_load   |   nvm_ready   | nvm_prog_trig | nvm_prog_mode |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x32  |  auto_offset_wordlength<1:0>  |  fast_offset_wordlength<1:0>  |fast_offset_en | fst_ofset_en_z| fst_ofset_en_y| fst_ofset_en_x|   w/r  |  0xC0   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x31  |     slow_offset_th<1:0>       |             slow_offset_dur<2:0>              | slw_ofset_en_z| slw_ofset_en_y| slw_ofset_en_x|   w/r  |  0x60   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x30  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   w/r  |  0xE8   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x2F  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   w/r  |  0xE0   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x2E  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   w/r  |  0x81   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x2D  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   w/r  |  0x40   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x2C  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   w/r  |  0x42   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x2B  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   w/r  |  0x22   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x2A  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   w/r  |  0xE8   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x29  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   w/r  |  0x19   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x28  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   w/r  |  0x24   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x27  |                                                        high_dur_z<7:0>                                                        |   w/r  |  0x19   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x26  |        high_hy_z<1:0>         |                                high_th_z<4:0>                                 |   high_en_z   |   w/r  |  0x02   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x25  |                                                        high_dur_y<7:0>                                                        |   w/r  |  0x19   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x24  |        high_hy_y<1:0>         |                                high_th_y<4:0>                                 |   high_en_y   |   w/r  |  0x02   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x23  |                                                        high_dur_x<7:0>                                                        |   w/r  |  0x19   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x22  |        high_hy_x<1:0>         |                                high_th_x<4:0>                                 |   high_en_x   |   w/r  |  0x02   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x21  |   reset_int   |  offset_reset |///////////////| latch_sts_bit |                         latch_int<3:0>                        |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x20  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x1F  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   w/r  |  0x28   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x1E  |  fifo_wm_en   |///////////////////////////////////////////////////////////////////////////////////////////////////////////////|   w/r  |  0x08   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x1D  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   w/r  |  0xC9   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x1C  |         awake_dur<1:0>        |        any_dursample<1:0>     |///////////////|   any_en_z    |   any_en_y    |   any_en_x    |   w/r  |  0xA0   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x1B  |fst_ofset_unflt|                                                   any_th<6:0>                                                 |   w/r  |  0x04   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x1A  |///////////////////////////////|slw_ofset_unflt|///////////////|high_unflt_data|///////////////| any_unflt_data|///////////////|   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x19  |///////////////////////////////////////////////////////////////|   int2_high   |///////////////|    int2_any   |///////////////|   wo   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x18  |   int2_data   |int2_fst_offset|   int2_fifo   |int2_auto_ofset|int1_auto_ofset|   int1_fifo   |int1_fst_offset|   int1_data   |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x17  |///////////////////////////////////////////////////////////////|    int1_high  |///////////////|    int1_any   |///////////////|   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x16  |///////////////////////////////////////////////////////////////|    int2_od    |    int2_lvl   |    int1_od    |    int1_lvl   |   w/r  |  0x0F   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x15  |  data_enable  |  fifo_enable  |///////////////////////////////////////////////////////////////////////////////////////////////|   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x14  |                                                          softreset                                                            |   wo   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x13  | data_high_bw  |   shadow_dis  |///////////////////////////////////////////////| auto_offset_en|///////////////////////////////|   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x12  | fast_powerup  |power_save_mode|        ext_trig_sel<1:0>      |///////////////|                sleep_dur<2:0>                 |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x11  |    suspend    |///////////////| deep_suspend  |///////////////|                sleep_dur<2:0>                 |///////////////|   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x10  |///////////////////////////////////////////////////////////////|                            bw<3:0>                            |   w/r  |  0x80   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x0F  |///////////////////////////////////////////////////////////////////////////////|                   range<2:0>                  |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x0E  |   overrun     |                                               frame_counter<6:0>                                              |   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x0D  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x0C  |///////////////////////////////////////////////////////////////|    high_sign  | high_first_z  | high_first_y  | high_first_x  |   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x0B  |///////////////////////////////////////////////////////////////|    any_sign   |  any_first_z  |  any_first_y  |  any_first_x  |   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x0A  |    data_int   |auto_offset_int|fast_offset_int|   fifo_int    |///////////////////////////////////////////////////////////////|   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x09  |///////////////////////////////////////////////////////////////////////////////|    any_int    |    high_int   |///////////////|   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x08  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x07  |                                                         rate_z<15:9>                                                          |   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x06  |                                                          rate_z<7:0>                                                          |   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x05  |                                                         rate_y<15:9>                                                          |   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x04  |                                                          rate_y<7:0>                                                          |   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x03  |                                                         rate_x<15:9>                                                          |   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x02  |                                                          rate_x<7:0>                                                          |   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x01  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   ro   |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x00  |                                                         chip_id<7:0>                                                          |   ro   |  0x0F   |
    -------------------------------------------------------------------------------------------------------------------------------------------------------------



    =============================================================================================================================================================
    |  ADDR  |       7       |       6       |       5       |       4       |       3       |       2       |       1       |       0       | ACCESS | DEFAULT |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x71  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x70  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x6F  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x6E  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x6D  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x6C  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x6B  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x6A  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x69  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x68  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x67  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x66  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x65  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x64  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x63  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x62  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x61  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x60  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x5F  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x5E  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x5D  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x5C  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x5B  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x5A  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x59  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x58  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x57  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x56  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x55  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x54  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x53  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x52  |                                                    rep_z_num_of_rep<7:0>                                                      |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x51  |                                                    rep_xy_num_of_rep<7:0>                                                     |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x50  |                                                      high_threshold<7:0>                                                      |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x4F  |                                                      low_threshold<7:0>                                                       |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x4E  |  drdy_pin_en  |   int_pin_en  |   channel_z   |   channel_y   |   channel_x   |  dr_polarity  |    int_latch  |  int_polarity |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------|
    |  0x4D  |  data_orun_en |  oflow_int_en | high_int_z_en | high_int_y_en | high_int_x_en |  low_int_z_en |  low_int_y_en |  low_int_x_en |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------|
    |  0x4C  |          adv_st<1:0>          |                 data_rate<2:0>                |         opmode<1:0>           |   self_test   |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x4B  |   soft_reset  |///////////////////////////////////////////////////////////////|     spi3_en   |   soft_reset  |  pwr_ctl_bit  |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------|
    |  0x4A  | data_overrun  |    overflow   |   high_int_z  |   high_int_y  |   high_int_x  |   low_int_z   |   low_int_y   |   low_int_x   |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------|
    |  0x49  |                                                           rhall<13:6>                                                         |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------|
    |  0x48  |                                           rhall<5:0>                                          |///////////////|   data_ready  |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x47  |                                                          data_z<14:7>                                                         |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x46  |                                                   data_z<6:0>                                                 |  z_self_test  |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x45  |                                                          data_y<12:5>                                                         |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x44  |                                  data_y<4:0>                                  |///////////////////////////////|  y_self_test  |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x43  |                                                          data_x<12:5>                                                         |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x42  |                                  data_x<4:0>                                  |///////////////////////////////|  x_self_test  |   w/r  |  0x00   |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x41  |///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////|   rsv  |  n/a    |
    +--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+--------+---------+
    |  0x40  |                                                         chip_id<7:0>                                                          |   ro   |  0x32   |
    -------------------------------------------------------------------------------------------------------------------------------------------------------------

"""

import math
import struct
import time

from machine import I2C

FMT_SINGLE_BYTE = '<B'
FMT_DOUBLE_BYTE = '<BB'

class FIFO_MODE:
    BYPASS =   0b00000000
    FIFO =     0b01000000
    STREAM =   0b10000000
    RESERVED = 0b11000000

class MAG_MODE:
    NORMAL =   0b00000000
    FORCED =   0b00000010
    RESERVED = 0b00000100
    SLEEP =    0b00000110

    PRESERVE = 0b11111001
    MASK =     0b00000110

class MAG_ODR:
    HZ_10 =    0b00000000
    HZ_2 =     0b00001000
    HZ_6 =     0b00010000
    HZ_8 =     0b00011000
    HZ_15 =    0b00100000
    HZ_20 =    0b00101000
    HZ_25 =    0b00110000
    HZ_30 =    0b00111000

    PRESERVE = 0b11000111
    MASK =     0b00111000

DEGREES_CONV_FACTOR = (180 / math.pi)

def radians_to_degrees(rad):
    degrees = rad * DEGREES_CONV_FACTOR
    if degrees < 0:
        degrees = 360 + degrees
    return degrees

class BMX055:

    ACC_ADDR_REG_TEMP = 0x08
    ACC_ADDR_FIFO_MODE = 0x3E

    ACC_MASK_FIFO_MODE = 0b11000000

    GYR_ADDR_FIFO_MODE = 0x0E
    GYR_MASK_FIFO_MODE = 0b11000000

    def __init__(self, peripheral=0, addr_accel=0x18, addr_gyro=0x68, addr_mag=0x10):
        self._addr_accel = addr_accel
        self._addr_gyro = addr_gyro
        self._addr_mag = addr_mag
        self._peripheral_id = peripheral
        self._i2c = I2C(self._peripheral_id)
        self._roll = 0
        self._pitch = 0
        self._yaw = 0
        return

    def init(self):
        i2c_found = self._i2c.scan()

        if len(i2c_found) > 0:
            print ("Devices Found:")
            for addr in i2c_found:
                print (addr)
            print ()

            #Verify we can talk to the accelerometer by reading its ID
            accel_id = self.accel_read_chip_id()
            print ("accel_id: 0x%02x" % accel_id)

            #Verify we can talk to the gyro by reading its ID
            gyro_id = self.gyro_read_chip_id()
            print ("gyro_id: 0x%02x" % gyro_id)

            #Enable the magnetometer and Verify we can talk to it by reading its ID
            self._enable_mag()
            mag_id = self.mag_read_chip_id()
            print ("mag_id: 0x%02x" % mag_id)

            self.mag_set_mode_and_rate(MAG_MODE.NORMAL, MAG_ODR.HZ_20)
        else:
            raise Exception("No I2C devices found on peripheral=%d." % self._peripheral_id)

        return

    def accel_read_axis_data(self):
        data = self._i2c.readfrom_mem(self._addr_accel, 0x02, 6)
        xval = self._merge_twos_complement_components(data[0:2], 4, 4)
        yval = self._merge_twos_complement_components(data[2:4], 4, 4)
        zval = self._merge_twos_complement_components(data[4:], 4, 4)
        return xval, yval, zval

    def accel_read_axis_x(self):
        data = self._i2c.readfrom_mem(self._addr_accel, 0x02, 2)
        val = self._merge_twos_complement_components(data, 4, 4)
        return val
    
    def accel_read_axis_y(self):
        data = self._i2c.readfrom_mem(self._addr_accel, 0x04, 2)
        val = self._merge_twos_complement_components(data, 4, 4)
        return val
    
    def accel_read_axis_z(self):
        data = self._i2c.readfrom_mem(self._addr_accel, 0x06, 2)
        val = self._merge_twos_complement_components(data, 4, 4)
        return val

    def accel_read_chip_id(self):
        val = self._i2c.readfrom_mem(self._addr_accel, 0x00, 1)
        return val[0]

    def calculate_orientation(self):
        self._roll = 0
        self._pitch = 0
        self._yaw = 0
        return

    def gyro_read_axis_data(self):
        data = self._i2c.readfrom_mem(self._addr_gyro, 0x02, 6)
        xval = self._merge_twos_complement_components(data[0:2], 0, 8)
        yval = self._merge_twos_complement_components(data[2:4], 0, 8)
        zval = self._merge_twos_complement_components(data[4:], 0, 8)
        return xval, yval, zval

    def gyro_read_axis_x(self):
        data = self._i2c.readfrom_mem(self._addr_gyro, 0x02, 2)
        val = self._merge_twos_complement_components(data, 0, 8)
        return val

    def gyro_read_axis_y(self):
        data = self._i2c.readfrom_mem(self._addr_gyro, 0x04, 2)
        val = self._merge_twos_complement_components(data, 0, 8)
        return val

    def gyro_read_axis_z(self):
        data = self._i2c.readfrom_mem(self._addr_gyro, 0x06, 2)
        val = self._merge_twos_complement_components(data, 0, 8)
        return val

    def gyro_read_chip_id(self):
        val = self._i2c.readfrom_mem(self._addr_gyro, 0x00, 1)
        return val[0]

    def mag_read_axis_data(self):
        data = self._i2c.readfrom_mem(self._addr_mag, 0x42, 8)
        xval = self._merge_twos_complement_components(data[0:2], 3, 5)
        yval = self._merge_twos_complement_components(data[2:4], 3, 5)
        zval = self._merge_twos_complement_components(data[4:6], 1, 7)
        rhall = self._merge_twos_complement_components(data[6:], 2, 6)
        return xval, yval, zval, rhall

    def mag_read_axis_x(self):
        data = self._i2c.readfrom_mem(self._addr_mag, 0x42, 2)
        val = self._merge_twos_complement_components(data, 3, 5)
        return val

    def mag_read_axis_y(self):
        data = self._i2c.readfrom_mem(self._addr_mag, 0x44, 2)
        val = self._merge_twos_complement_components(data, 3, 5)
        return val

    def mag_read_axis_z(self):
        data = self._i2c.readfrom_mem(self._addr_mag, 0x46, 2)
        val = self._merge_twos_complement_components(data, 1, 7)
        return val

    def mag_read_chip_id(self):
        val = self._i2c.readfrom_mem(self._addr_mag, 0x40, 1)
        return val[0]

    def mag_read_heading(self):
        xval, yval, zval, rhall = self.mag_read_axis_data()
        heading  = math.atan2(yval, xval) * DEGREES_CONV_FACTOR
        if heading < 0:
            heading = 360 + heading
        return heading

    def mag_read_rhall(self):
        data = self._i2c.readfrom_mem(self._addr_mag, 0x48, 2)
        val = self._merge_twos_complement_components(data, 2, 6)
        return val

    def mag_set_mode_and_rate(self, mode, rate):
        val = mode | rate
        data = struct.pack(FMT_SINGLE_BYTE, val)
        self._i2c.writeto_mem(self._addr_mag, 0x4C, data)
        return

    def _enable_mag(self):
        self._i2c.writeto_mem(self._addr_mag, 0x4B, b'\x01')
        self._i2c.writeto_mem(self._addr_mag, 0x4C, b'\x00')
        return

    def _merge_twos_complement_components(self, data, lsb_shift, msb_shift):

        # We need to create a mask because later when we complement
        # the bits we will need to throw away the high bits that
        # were changed from zeros to ones
        mask = 0xff << msb_shift | 0xff

        val_lsb = data[0]
        val_msb = data[1]

        # Save wether the high bit was set before we do any shifting
        # on the MSB value, because its easier to check now because
        # its always in the highest position
        is_neg = True if (val_msb & 0b10000000) > 0 else False

        # Shift the LSB and MSB bits into place
        val_lsb_adj = val_lsb >> lsb_shift
        val_msb_adj = val_msb << msb_shift

        # combine the LSB and MSB bits to get a twos complement
        # string of bits.  If the MSB high bit was not set the
        # our value is good
        val = val_msb_adj | val_lsb_adj

        # If the MSB high bit was set, we need to adjust this number
        # by converting it to its ones complement and then multiply
        # by negative one to make it negative again but fitting in
        # a larger integer space
        if is_neg:
            val = (((~val) & mask) + 1) * -1

        return val

